<p><style> @import url('style.css'); </style></p>

<p><img src="media/TUOS_PRIMARY_LOGO_FULL COLOUR.png" height=100px align=right></p>

<h1>Hands-on RNA-seq Analysis in Galaxy</h1>

<h2>Acknowledgement</h2>

<p><em>Based on the RNA-Seq workshop by Melbourne Bioinformatics written by Mahtab Mirmomeni, Andrew Lonie, Jessica Chung</em> <a href="http://vlsci.github.io/lscc_docs/tutorials/rna_seq_dge_advanced/rna_seq_advanced_tutorial/">Original</a></p>

<p><em>Modified by David Powell (Monash Bioinformatics Platform)</em></p>

<p><em>Further Modified by Mark Dunning of Sheffield Bioinformatics Core</em></p>

<h3>Sheffield Bioinformatics Core</h3>

<p>web : <a href="https://sbc.shef.ac.uk">sbc.shef.ac.uk</a> <br />
twitter: <a href="https://twitter.com/SheffBioinfCore">@SheffBioinfCore</a> <br />
email: <a href="bioinformatics-core@sheffield.ac.uk">bioinformatics-core@sheffield.ac.uk</a></p>

<hr />

<h2>Tutorial Overview</h2>

<p>This tutorial will cover the basics of RNA-seq using Galaxy; a open-source web-based platform for the analysis of biological data. You should gain an appreciation of the tasks involved in a typical RNA-seq analysis and be comfortable with the outputs generated by the Bioinformatician.</p>

<h3>More on Galaxy</h3>

<p>The official Galaxy page has many <a href="https://galaxyproject.org/learn/">tutorials</a> on using the service, and examples of other types of analysis that can be performed on the platform.</p>

<p>Those eventually wanted to perform their own RNA-seq analysis (for example in R), should look out for other courses</p>

<h3>Courses on analysing RNA-seq data in R</h3>

<ul>
<li><a href="https://bioinformatics-core-shared-training.github.io/RNAseq-R/">Cancer Research Uk Bioinformatics Core</a></li>
<li><a href="http://monashbioinformaticsplatform.github.io/RNAseq-DE-analysis-with-R/">Monash Bioinformatics Platform</a></li>
</ul>

<hr />

<h2>Background [15 min]</h2>

<h4>Where do the data in this tutorial come from?</h4>

<p>The data for this tutorial is from the paper, <em>A comprehensive comparison of
RNA-Seq-based transcriptome analysis from reads to differential gene expression
and cross-comparison with microarrays: a case study in Saccharomyces
cerevisiae</em> by Nookaew et al. [1] which studies S.cerevisiae strain CEN.PK
113-7D (yeast) under two different metabolic conditions: glucose-excess (batch)
or glucose-limited (chemostat).</p>

<p>The RNA-Seq data has been uploaded in NCBI, short read archive (SRA), with
accession SRS307298. There are 6 samples in total-- two treatments with
three biological replicates each sequenced paired-end.  We have selected only
the first read, and only two replicates of each condition to keep the data small
for this workshop.</p>

<p>We have extracted chromosome I reads from the samples to make the
tutorial a suitable length. </p>

<p>For this tutorial, we will assume that the <em>wet-lab</em> stages of the experiment have been performed and we are now in the right-hand branch of the workflow. In this tutorial we will demonstrate the steps of <strong>Quality assessment</strong>, <strong>alignment</strong>, <strong>quantification</strong> and <strong>differential expression testing</strong>.</p>

<h2>Section 1: Preparation [15 min]</h2>

<h4>1.  Register as a new user on one of the public Galaxy servers</h4>

<ul>
<li>https://galaxy-mel.genome.edu.au/galaxy/</li>
<li>http://galaxy-tut.genome.edu.au/galaxy/</li>
<li>https://galaxy-qld.genome.edu.au/galaxy</li>
<li>https://galaxy.hidelab.org/</li>
</ul>

<p><strong>Make sure you check your email to activate your account</strong></p>

<h4>2.  Import the RNA-seq data for the workshop.</h4>

<p>We can going to import the <a href="https://en.wikipedia.org/wiki/FASTQ_format"><em>fastq</em> files</a> for this experiment. This is a standard format for storing raw sequencing reads and their associated quality scores. Each read is described by 4 lines in the file:-</p>

<p><img src="media/fastq-header.png"></p>

<p>The quality scores are <a href="http://ascii-code.com/">ASCII</a> representations of how confident we are that a particular base has been called correctly. Letters that are further along the alphabet indicate higher confidence. This is important when trying to identify types of genome variation such as single base changes, but is also indicative of the overall quality of the sequencing. Different scales have been employed over time (resulting in a different set of characters appearing in the file). We will need to tell Galaxy which scale has been used in order that we can process the data correctly.</p>

<p><img src="media/phred.png"></p>

<p>You can import the data by:</p>

<ol>
<li>In the tool panel located on the left, under Basic Tools select <strong>Get
Data > Upload File</strong>. Click on the <strong>Paste/Fetch data</strong> button on the
bottom section of the pop-up window.</li>
<li><p>Upload the sequence data by pasting the following links into the text
input area.
These two files are single-end samples from the batch condition
(glucose-excess). Make sure the type is specified as 'fastqsanger'
when uploading.</p>

<div class="code">
https://swift.rc.nectar.org.au:8888/v1/AUTH_a3929895f9e94089ad042c9900e1ee82/RNAseqDGE_ADVNCD/batch1_chrI_1.fastq
<br>
https://swift.rc.nectar.org.au:8888/v1/AUTH_a3929895f9e94089ad042c9900e1ee82/RNAseqDGE_ADVNCD/batch2_chrI_1.fastq
<br>
</div>

<p>These two files are single-end samples from the chem condition
(glucose-limited). Make sure the type is specified as 'fastqsanger'
when uploading.</p>

<div class="code">
https://swift.rc.nectar.org.au:8888/v1/AUTH_a3929895f9e94089ad042c9900e1ee82/RNAseqDGE_ADVNCD/chem1_chrI_1.fastq
<br>
https://swift.rc.nectar.org.au:8888/v1/AUTH_a3929895f9e94089ad042c9900e1ee82/RNAseqDGE_ADVNCD/chem2_chrI_1.fastq
<br>
</div>

<p>Then, upload this file of gene definitions. You do not need to specify
the type for this file as Galaxy will auto-detect the file as a GTF
file.</p>

<div class="code">
https://swift.rc.nectar.org.au:8888/v1/AUTH_a3929895f9e94089ad042c9900e1ee82/RNAseqDGE_ADVNCD/genes.gtf
</div></li>
<li><p>You should now have these 5 files in your history:</p>

<ul>
<li><code>batch1_chrI_1.fastq</code></li>
<li><code>batch2_chrI_1.fastq</code></li>
<li><code>chem1_chrI_1.fastq</code></li>
<li><code>chem2_chrI_1.fastq</code></li>
<li><code>genes.gtf</code></li>
</ul>

<p>These files can be renamed by clicking the <strong>pen icon</strong> if you wish.</p>

<p><strong>Note:</strong> Low quality reads have already been trimmed.</p></li>
</ol>

<hr />

<h2>Section 2: Quality assessment with FastQC</h2>

<p><a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> is a popular tool from <a href="https://www.bioinformatics.babraham.ac.uk/index.html">Babraham Institute Bioinformatics Group</a> used for <em>quality assessment</em> of sequencing data. Most Bioinformatics pipelines will use FastQC, or similar tools in the first stage of the analysis. The <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/">documentation</a> for FastQC will help you to interpret the plots and stats produced by the tool. A traffic light system is used to alert the user's attention to possible issues. However, it is worth bearing in mind that the tool is blind to the particular type of sequencing you are performing (i.e. whole-genome, ChIP-seq, RNA-seq), so some warnings might be expected due to the nature of your experiment.</p>

<ul>
<li>From the left hand tool panel in Galaxy, under <em>NGS ANALYSIS</em>, select <em>NGS: QC and manipulation -> FastQC</em></li>
<li>Select one of the FASTQ files as input and <em>Execute</em> the tool.</li>
<li>When the tool finishes running, you should have an HTML file in your History. Click on the eye icon to view the various quality metrics.</li>
</ul>

<p>Look at the generated FastQC metrics. This data looks pretty good - high per-base quality scores (most above 30).</p>

<p><img src="media/fastqc.png" height=700px></p>

<h2>Section 3: Alignment [30 mins]</h2>

<p>In this section we map the reads in our FASTQ files to a reference genome. As
these reads originate from mRNA, we expect some of them will cross exon/intron
boundaries when we align them to the reference genome. Tophat is a splice-aware
mapper for RNA-seq reads that is based on Bowtie. It uses the mapping results
from Bowtie to identify splice junctions between exons. More information on
Tophat can be found <a href="https://ccb.jhu.edu/software/tophat/index.shtml">here</a>.</p>

<h4>1.  Map/align the reads with Tophat to the S. cerevisiae reference</h4>

<p>In the left tool panel menu, under NGS Analysis, select
<strong>NGS: RNA Analysis > Tophat</strong> and set the parameters as follows:  </p>

<ul>
<li><strong>Is this single-end or paired-end data?</strong> Single-end (as individual datasets)  </li>
<li><p><strong>RNA-Seq FASTQ file, forward reads:</strong> <br />
(Click on the <strong>multiple datasets icon</strong> and select all four of the
FASTQ files)</p>

<ul>
<li><code>batch1_chrI_1.fastq</code></li>
<li><code>batch2_chrI_1.fastq</code></li>
<li><code>chem1_chrI_1.fastq</code></li>
<li><code>chem2_chrI_1.fastq</code></li>
</ul></li>
<li><p><strong>Use a built in reference genome or own from your history:</strong> Use
built-in genome</p></li>
<li><strong>Select a reference genome:</strong> S. cerevisiae June 2008 (SGD/SacCer2)
(sacCer2)</li>
<li>Use defaults for the other fields</li>
<li>Execute</li>
</ul>

<p><img src="media/rna_advanced_tophat.png" height=800px></p>

<p>Note: This may take a few minutes, depending on how busy the server is.</p>

<h4>2.  Rename the output files</h4>

<p>You should have 5 output files for each of the FASTQ input files:</p>

<ul>
<li><strong>Tophat on data 1: accepted_hits:</strong> This is a BAM file containing
sequence alignment data of the reads. This file contains the location
of where the reads mapped to in the reference genome. We will examine
this file more closely in the next step.</li>
<li><strong>Tophat on data 1: splice junctions:</strong> This file lists all the places
where TopHat had to split a read into two pieces to span an exon
junction.</li>
<li><strong>Tophat on data 1 deletions</strong> and <strong>Tophat on data 1: insertions:</strong>
These files list small insertions or deletions found in the reads.
Since we are working with synthetic reads we can ignore Tophat for
Illumina data 1:insertions Tophat for Illumina data 1:deletions for now.</li>
<li><strong>Tophat on data 1: align_summary:</strong> This file gives some mapping
statistics including the number of reads mapped and the mapping rate.</li>
</ul>

<p>You should have a total of 20 Tophat output files in your history.</p>

<p>Rename the 4 accepted_hits files into a more meaningful name (e.g.
'Tophat on data 1: accepted<em>hits' to 'batch1-accepted</em>hits.bam')
by using the <strong>pen icon</strong> next to the file.</p>

<h3>About the <code>bam</code> file format</h3>

<p>Unlike most of Bioinfomatics, a <em>single standard</em> file format has emerged for aligned reads. Moreoever, this file format is consistent regardless of whether you have DNA-seq, RNA-seq, ChIP-seq... data. </p>

<p>The <code>bam</code> file is a compressed, binary, version of a <code>sam</code> file.</p>

<h2>The <code>.sam</code> file</h2>

<ul>
<li><strong>S</strong>equence <strong>A</strong>lignment/<strong>M</strong>ap (sam) </li>
<li>The output from an aligner such as <code>bwa</code></li>
<li>Same format regardless of sequencing protocol (i.e. RNA-seq, ChIP-seq, DNA-seq etc)</li>
<li>May contain un-mapped reads</li>
<li>Potentially large size on disk; ~100s of Gb
<ul>
<li>Can be manipulated with standard unix tools; e.g. <em>cat</em>, <em>head</em>, <em>grep</em>, <em>more</em>, <em>less</em>....</li>
</ul></li>
<li>Official specification can be <a href="http://samtools.github.io/hts-specs/SAMv1.pdf">obtained online</a>: -</li>
<li>We normally work on a compressed version called a <code>.bam</code> file. See later.</li>
<li><em>Header</em> lines starting with an <code>@</code> character, followed by tab-delimited lines
<ul>
<li>Header gives information about the alignment and references sequences used</li>
</ul></li>
</ul>

<p>The first part of the header lists the names (<code>SN</code>) of the sequences (chromosomes) used in alignment, their length (<code>LN</code>) and a <em>md5sum</em> "<a href="https://en.wikipedia.org/wiki/Md5sum">digital fingerprint</a>" of the <code>.fasta</code> file used for alignment (<code>M5</code>).</p>

<p>```
@HD VN:1.5  SO:coordinate   GO:none
@SQ SN:1    LN:249250621    M5:1b22b98cdeb4a9304cb5d48026a85128
@SQ SN:2    LN:243199373    M5:a0d9851da00400dec1098a9255ac712e
@SQ SN:3    LN:198022430    M5:fdfd811849cc2fadebc929bb925902e5
@SQ SN:4    LN:191154276    M5:23dccd106897542ad87d2765d28a19a1
.....
.....</p>

<p>```</p>

<p>Next we can define the <em>read groups</em> present in the file which we can use to identify which sequencing library, sequencing centre, Lane, sample name etc.</p>

<p>```
@RG ID:SRR077850    CN:bi   LB:Solexa-42057 PL:illumina PU:ILLUMINA SM:NA06984
@RG ID:SRR081675    CN:bi   LB:Solexa-42316 PL:illumina PU:ILLUMINA SM:NA06984
@RG ID:SRR080818    CN:bi   LB:Solexa-44770 PL:illumina PU:ILLUMINA SM:NA06984
@RG ID:SRR084838    CN:bi   LB:Solexa-42316 PL:illumina PU:ILLUMINA SM:NA06984
@RG ID:SRR081730    CN:bi   LB:Solexa-42316 PL:illumina PU:ILLUMINA SM:NA06984
.....
.....</p>

<p>```</p>

<p>Finally, we have a section where we can record the processing steps used to derive the file
```
@PG ID:MosaikAligner    CL:/share/home/wardag/programs/MOSAIK/bin/MosaikAligner -in /scratch/wardag/NA06984.SRR077850.mapped.illumina.mosaik.CEU.SINGLE.20111114/NA06984.SRR077850.mapped.illumina.mosaik.CEU.SINGLE.20111114.mkb -out
....
....</p>

<p>```</p>

<p>Next is a <em>tab-delimited</em> section that describes the alignment of each sequence in detail. </p>

<p>```
SRR081708.237649    163 1   10003   6   1S67M   =   10041   105 GACCCTGACCCTAACCCTGACCCTGACCCTAACCCTGACCCTGACCCTAACCCTGACCCTAACCCTAA    S=&lt;====&lt;&lt;>=><?=?=?>==@??;?>@@@=??@@????@??@?>?@@&lt;@>@'@=?=??=&lt;=>?>?=Q    ZA:Z:&lt;&amp;;0;0;;308;68M;68>&lt;@;0;0;;27;;>MD:Z:5A11A5A11A5A11A13 RG:Z:SRR081708  NM:i:6  OQ:Z:GEGFFFEGGGDGDGGGDGA?DCDD:GGGDGDCFGFDDFFFCCCBEBFDABDD-D:EEEE=D=DDDDC:</p>

<p>```</p>

<p><img src="media/sam-entry-explained.png" alt="" title="" /></p>

<p>Column | Official Name | Brief
------ | -------------- | -----------
1      | QNAME          | Sequence ID
2      | FLAG           | Sequence quality expressed as a bitwise flag
3      | RNAME          | Chromosome
4      | POS            | Start Position
5      | MAPQ           | Mapping Quality
6      | CIGAR          | Describes positions of matches, insertions, deletions w.r.t reference
7      | RNEXT          | Ref. name of mate / next read
8      | PNEXT          | Postion of mate / next read
9      | TLEN           | Observed Template length
10     | SEQ            | Sequence
11     | QUAL           | Base Qualities</p>

<p>There can also be all manner of optional tags as extra columns introduce by an aligner or downstream analysis tool. A common use is the <code>RG</code> tag which refers back to the read groups in the header.</p>

<p>Unlike the <code>.fastq</code> files, where we had a separate file for forward and reverse reads, the <code>.sam</code> file contains all reads. Reads that are paired with each other should appear in consecutive lines in the <code>.sam</code> file generated by an aligner. Otherwise it is more common for the file to be sorted according to genomic coordinates. The paired reads should share the same sequence ID in the first column (sometimes with a <code>/1</code> or <code>/2</code> to indicate which is which).</p>

<p><img src="media/pairs-explained.png" alt="" title="" /></p>

<h2>Dr Mark Dunning presents....Fun with flags!</h2>

<p>The <em>"flags"</em> in the sam file can represent useful QC information</p>

<ul>
<li>Read is unmapped</li>
<li>Read is paired / unpaired</li>
<li>Read failed QC</li>
<li>Read is a PCR duplicate (see later)</li>
</ul>

<p>The combination of any of these properties is used to derive a numeric value</p>

<p>For instance, a particular read has a flag of 163</p>

<p><img src="media/flag-highlight.png" alt="" title="" /></p>

<h3>Derivation</h3>

<p>There is a set of properties that a read can possess. If a particular property is observed, a corresponding power of 2 is added multiplied by 1. The final value is derived by summing all the powers of 2.</p>

<p>```
    ReadHasProperty     Binary  MultiplyBy
isPaired    TRUE    1   1
isProperPair    TRUE    1   2
isUnmappedQuery     FALSE   0   4
hasUnmappedMate     FALSE   0   8
isMinusStrand   FALSE   0   16
isMateMinusStrand   TRUE    1   32
isFirstMateRead     FALSE   0   64
isSecondMateRead    TRUE    1   128
isSecondaryAlignment    FALSE   0   256
isNotPassingQualityControls     FALSE   0   512
isDuplicate     FALSE   0   1024</p>

<p><code>
Value of flag is given by
</code>
1x1 + 1x2 + 0x4 + 0x8 + 0x16 + 1x32 + 0x64 + 1x128 + 0x256 + 0x512 + 0x1024 = 163
```</p>

<p>See also</p>

<ul>
<li>https://broadinstitute.github.io/picard/explain-flags.html</li>
</ul>

<h2>Have a CIGAR!</h2>

<p><img src="images/cigar-highlight.png" alt="" title="" /></p>

<p>The <strong><em>CIGAR</em></strong> (<strong>C</strong>ompact <strong>I</strong>diosyncratic <strong>G</strong>apped <strong>Alignment</strong> <strong>R</strong>eport) string is a way of encoding the match between a given sequence and the position it has been assigned in the genome. It is comprised by a series of letters and numbers to indicate how many consecutive bases have that mapping.</p>

<p>Code  | Description
------------- | -------------
M  | alignment match
I  | insertion
D  | deletion
N  | skipped
S  | soft-clipping
H  | hard-clipping</p>

<p>e.g.</p>

<ul>
<li><code>68M</code>
<ul>
<li>68 bases matching the reference</li>
</ul></li>
<li><code>1S67M</code>
<ul>
<li>1 soft-clipped read followed by 67 matches</li>
</ul></li>
<li><code>15M87N70M90N16M</code>
<ul>
<li>15 matches following by 87 bases skipped followed by 70 matches etc.</li>
</ul></li>
</ul>

<p>Rather than dealing with <code>.sam</code> files, we usually analyse a <code>.bam</code> file.</p>

<h4>[Optional] Convert BAM to SAM</h4>

<p>It useful to understand the BAM/SAM format.  Convert one of your BAM files to SAM format, and
view the text within Galaxy
1.  <strong>NGS: SAM Tools> BAM-to-SAM convert BAM to SAM</strong> and select one of you BAM files
2.  Click on the eye of the resulting file to view the SAM alignments.
3.  Look through the alignments, which chromosome are the aligning to?  Can you see any indels in the CIGAR string?</p>

<hr />

<h4>3  Visualise the aligned reads with IGV</h4>

<p>Download the bam files you have created in the previous step by clicking the disk icon on the right-hand panel. Make sure to click both the <strong>Download dataset</strong> and <strong>Download index</strong> buttons. We will now visualise the alignments using the Integrative Genomics Viewer (IGV).</p>

<p><img src="media/download_bam.png"></p>

<ul>
<li>http://software.broadinstitute.org/software/igv/</li>
<li>Go to <em>Downloads</em></li>
<li>Launch with 1.2Gb</li>
<li>Click on igv24_mm.jnlp file that is downloaded</li>
</ul>

<h2>Introducing the IGV Browser</h2>

<p><img src="media/igv.png" alt="" title="" /></p>

<p>Whilst tools like R are very powerful and allow you to perform statistical analyses and test hypotheses, there is no substitute for <strong><em>looking at the data</em></strong>. A trained-eye can quite quickly get a sense of the data quality before any computational analyses have been run. Futhermore, as the person requesting the sequencing, you probably know a lot about the biological context of the samples and what to expect. </p>

<ul>
<li>IGV has been developed by the Broad Institute and is able to display most kinds of genomic data
<ul>
<li>expression</li>
<li>ChIP</li>
<li>whole-genome resequencing</li>
<li>shRNA</li>
</ul></li>
<li>It is a <em>Java</em> desktop application and can be run either locally of from the Broad website
<ul>
<li>You have a link to IGV on the taskbar on the left the screen in-front of you</li>
</ul></li>
<li>To run IGV yourself you will need to agree to the license and <a href="http://www.broadinstitute.org/software/igv/download">download the version for your OS</a></li>
</ul>

<h2>A quick tour of IGV</h2>

<p>For more details</p>

<ul>
<li>Full set of slides from <a href="http://mrccsc.github.io/IGV_course/igv.html#/">MRC Clinical Sciences Centre</a></li>
<li>IGV tutorial from the <a href="https://github.com/griffithlab/rnaseq_tutorial/wiki/IGV-Tutorial">Griffth lab - WashU</a></li>
</ul>

<p><img src="media/IGV2.png" alt="" title="" /></p>

<p>1) Sample information panel
    - Information about samples you have loaded
    - e.g. Sample ID, Gender, Age, Tumour / Normal</p>

<p>2) Genome Navigation panel
    - Jump to a genomic region in <code>Chr:Start-End</code> format
    - Jump to a gene symbol of interest</p>

<p>3) Data panel
    - Your sequencing reads will be displayed here
    - Or whatever data you have loaded
        + see information on <a href="http://www.broadinstitute.org/software/igv/RecommendedFileFormats">accepted file formats</a></p>

<p>4) Attribute panel
    - Gene locations
    - Genome sequence (if zoomed-in at appropriate level)
    - Proteins</p>

<h2>Example</h2>

<p>Go to <strong><em>File</em></strong> -> <strong><em>Load from file</em></strong> and select the aligned <code>bam</code> files from <code>Tophat</code>. Note that the index files <code>.bai</code> need to be present in the same directory. However, you only need to click on the <code>.bam</code></p>

<ul>
<li>The black dotted vertical lines indicates the centre of the view</li>
<li>Each of the grey pointed rectangles represents a sequencing reads
<ul>
<li>whether the pointed bit is on the left or right indicates if the read is forward or reverse.</li>
</ul></li>
<li>A coverage track is also generated</li>
<li>You should see the read that we described in detail in the previous section by <em>hover</em>ing over the reads to display the information from the <code>.bam</code> file</li>
</ul>

<p><img src="media/read-select.png" alt="" title="" /></p>

<p>The view in IGV is not static and we can scroll-along the genome by holding-down the left mouse in the data panel and dragging left and right</p>

<h2>Viewing preferences</h2>

<p>IGV allows us to configure many aspects of the data display</p>

<p><strong><em>Menu:-</em></strong> <strong><em>View -> Alignments</em></strong></p>

<p><img src="media/alignment-prefs.png" alt="" title="" /></p>

<p>It's worth noting that the display settings may be showing fewer reads than you have (<em>downsampling</em>) in order to conserve memory. Also, some QC-fail or PCR duplicates may be filtered.</p>

<p>We also have some options on how to display the reads themselves, which we can acccess by right-clicking on the bam track</p>

<p>Sorting alignments by:-</p>

<ul>
<li>start</li>
<li>strand</li>
<li>base</li>
<li>mapping quality</li>
<li>insert size</li>
</ul>

<p>The reads themselves can also be coloured according to</p>

<ul>
<li>insert size</li>
<li>read strand</li>
<li>sample</li>
</ul>

<p>Experiment with the various settings by right clicking the read alignment track and toggling the options. Think about which would be best for specific tasks (e.g. quality control, SNP calling, CNV finding). We will re-visit these options later when we come to examine particular variant calls</p>

<h2>Additional data tracks</h2>

<p>Additional data tracks are also available on the IGV server. These include useful genome annotation tracks, such as:-</p>

<ul>
<li>GC percentage</li>
<li>CpG islands</li>
<li>Repeat regions</li>
<li>dbSNP calls</li>
</ul>

<h2>Section 4. Quantification (Counting reads in features) [30 min]</h2>

<p>In order to test for differential expression, we need to count up how many times each "feature" is observed is each sample. We can then apply statistical tests to these data</p>

<p><img src="media/counts.png" alt="" title="" /></p>

<p>HTSeq-count creates a count matrix using the number of the reads from each bam
file that map to the genomic features in the genes.gtf. For each feature (a
gene for example) a count matrix shows how many reads were mapped to this
feature.</p>

<p>Various rules are used to assign counts to features</p>

<p><img src="media/htseq.png" alt="" title="" /></p>

<ol>
<li><p>Use HTSeq-count to count the number of reads for each feature. <br />
In the left tool panel menu, under NGS Analysis, select
<strong>NGS Analysis > htseq-count*</strong> and set the parameters as follows:  </p>

<ul>
<li><strong>Gene model (GFF) file to count reads over from your current history:</strong> genes.gtf</li>
<li><strong>bam/sam file from your history:</strong> <br />
(Select one of six bam files)
<ul>
<li><code>batch1-accepted_hits.bam</code></li>
</ul></li>
<li>Use defaults for the other fields</li>
<li>Execute</li>
</ul></li>
<li><p>Repeat for the remaining bam files</p></li>
</ol>

<p>We now have a count matrix, with a count against each corresponding sample. We
will use this matrix in later sections to calculate the differentially
expressed genes.</p>

<h2>Section 5: DEseq2  [30 min]</h2>

<p>[DESeq2](https://bioconductor.org/packages/release/bioc/html/DESeq2.html
is an R package, that is used for analysing differential expression of
RNA-Seq data and can either use exact statistical methods or generalised
linear models.</p>

<p>To use this tool, you will have to use the <strong>htseq-count</strong> tool to obtain counts from each aligned bam file (<strong>Section 4 - alternative tool</strong>).</p>

<p>In the Galaxy tool panel, under NGS Analysis, select
<strong>NGS: RNA Analysis > DESeq2</strong> and set the parameters as follows:</p>

<ul>
<li><strong>1. Factor level</strong> Batch</li>
<li><strong>Count files</strong> <br />
<ul>
<li><code>batch1-htseq</code></li>
<li><code>batch2-htseq</code></li>
</ul></li>
<li><strong>2. Factor level:</strong> Chem</li>
<li><strong>Select columns containing control:</strong> <br />
<ul>
<li><code>chem1-htseq</code></li>
<li><code>chem2-htseq</code></li>
</ul></li>
<li>Use defaults for the other fields</li>
<li>Execute</li>
</ul>

<h4>2.  Examine the outputs from the previous step</h4>

<ol>
<li>Examine the <code>DeSeq2 result file</code>by
clicking on the <strong>eye icon</strong>.
This file is a list of genes sorted by p-value from using DESeq2 to
perform differential expression analysis.</li>
<li>Examine the <code>DeSeq2 plots</code> file. This file has some
plots from running DESeq2, including PCA and clustering showing relationships between samples</li>
</ol>

<h4>3.  Extract the significant differentially expressed genes.</h4>

<p>Under Basic Tools, click on <strong>Filter and Sort > Filter</strong>:</p>

<ul>
<li><strong>Filter:</strong> <code>DESeq2 results file</code></li>
<li><strong>With following condition:</strong> <code>c7 &lt; 0.05 and (c3 &gt; 1.0 or c3 &lt; -1.0)</code></li>
<li><strong>Number of header lines to skip:</strong> 1</li>
<li>Execute</li>
</ul>

<p>This will keep the genes that have an adjusted p-value (column 7 in the table) of less
or equal to 0.05 and have a fold change of greater than 1 or less than -1. There should be 22 genes in this file.
Rename this file by clicking on the <strong>pencil icon</strong> of and change the name
from "Filter on data x" to <code>DESeq2_Significant_DE_Genes</code></p>

<h2>Exploring the DESeq2 plots</h2>

<h2>References</h2>

<p>[1] Nookaew I, Papini M, Pornputtpong N, Scalcinati G, Fagerberg L, Uhlén M, Nielsen J: A comprehensive comparison of RNA-Seq-based transcriptome analysis from reads to differential gene expression and cross-comparison with microarrays: a case study in Saccharomyces cerevisiae. Nucleic Acids Res 2012, 40 (20):10084 – 10097. doi:10.1093/nar/gks804. Epub 2012 Sep 10</p>

<p>[2] Guirguis A, Slape C, Failla L, Saw J, Tremblay C, Powell D, Rossello F, Wei A, Strasser A, Curtis D: PUMA promotes apoptosis of hematopoietic progenitors driving leukemic progression in a mouse model of myelodysplasia. Cell Death Differ. 2016 Jun;23(6)</p>
